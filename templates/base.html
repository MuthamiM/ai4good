<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description"
    content="Fin AI — AI-powered financial inclusion platform for budgeting, microfinance, and savings." />
  <title>{% block title %}Fin AI{% endblock %}</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
    rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/analytics.css') }}" />
</head>

<body>
  <!-- ── Navigation ─────────────────────────────────────────────────── -->
  <nav class="navbar" id="navbar">
    <a href="/" class="nav-brand">
      <div class="brand-icon"><i class="fas fa-coins"></i></div>
      <span>Fin <span class="accent">AI</span></span>
    </a>

    <button class="nav-toggle" id="navToggle" aria-label="Toggle navigation">
      <span></span><span></span><span></span>
    </button>

    <ul class="nav-links" id="navLinks">
      <li><a href="/" class="{{ 'active' if request.path == '/' }}"><i class="fas fa-home"></i> Home</a></li>
      <li><a href="/dashboard" class="{{ 'active' if request.path == '/dashboard' }}"><i class="fas fa-chart-pie"></i>
          Dashboard</a></li>
      <li><a href="/budget" class="{{ 'active' if request.path == '/budget' }}"><i class="fas fa-wallet"></i> Budget</a>
      </li>
      <li><a href="/loans" class="{{ 'active' if request.path == '/loans' }}"><i class="fas fa-hand-holding-usd"></i>
          Loans</a></li>
      <li><a href="/savings" class="{{ 'active' if request.path == '/savings' }}"><i class="fas fa-piggy-bank"></i>
          Savings</a></li>
      <li><a href="/chat" class="{{ 'active' if request.path == '/chat' }}"><i class="fas fa-robot"></i> Chat</a></li>
      <li><a href="/analytics" class="{{ 'active' if request.path == '/analytics' }}"><i class="fas fa-chart-line"></i>
          Analytics</a></li>
      <li id="auth-nav-item" style="display: flex; align-items: center; justify-content: center; min-height: 40px;">
        <!-- Clerk UserButton or Sign In will be mounted here -->
      </li>
    </ul>
  </nav>

  <!-- ── Main Content ───────────────────────────────────────────────── -->
  <main class="main-content">
    {% block content %}{% endblock %}
  </main>

  <!-- ── Footer ─────────────────────────────────────────────────────── -->
  <footer class="footer">
    <div class="footer-inner">
      <p>&copy; 2026 Fin AI &mdash; AI for Good Hackathon</p>
      <p class="footer-tag">Empowering financial inclusion through artificial intelligence</p>
    </div>
  </footer>

  <script src="{{ url_for('static', filename='js/app.js') }}"></script>

  <!-- Clerk Authentication Integration -->
  <script async crossorigin="anonymous"
    data-clerk-publishable-key="pk_test_dGFsZW50ZWQtZG9iZXJtYW4tNzYuY2xlcmsuYWNjb3VudHMuZGV2JA"
    src="https://cdn.jsdelivr.net/npm/@clerk/clerk-js@5/dist/clerk.browser.js" type="text/javascript"></script>

  <script>
    window.addEventListener('load', async function () {
      await Clerk.load();

      // Global Route Protection
      const publicRoutes = ['/'];
      if (!window.Clerk.user && !publicRoutes.includes(window.location.pathname)) {
        window.location.href = "/?sign_in=true";
        return;
      }

      const authNavItem = document.getElementById('auth-nav-item');

      if (Clerk.user) {
        // Mount User Profile Button
        authNavItem.innerHTML = '<div id="clerk-user-button"></div>';
        Clerk.mountUserButton(document.getElementById('clerk-user-button'), {
          appearance: {
            layout: { termsPageUrl: "https://clerk.com/terms" }
          }
        });
      } else {
        // Mount Sign In Button
        authNavItem.innerHTML = '<button class="btn btn-primary" style="padding: 0.5rem 1rem; border-radius: 8px;" onclick="Clerk.openSignIn()">Sign In</button>';
      }

      // Intercept purely secure links
      const secureLinks = document.querySelectorAll('a.require-auth');
      secureLinks.forEach(link => {
        link.addEventListener('click', (e) => {
          if (!Clerk.user) {
            e.preventDefault();
            Clerk.openSignIn({ redirectUrl: link.href });
          }
        });
      });
    });
  </script>
</body>

</html>